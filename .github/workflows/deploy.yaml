# .github/workflows/deploy.yml

name: Deploy to GitHub Pages

# æ§åˆ¶å·¥ä½œæµä½•æ—¶è¿è¡Œ
on:
  push:
    branches:
      - main # æˆ–è€…æ‚¨çš„ä¸»åˆ†æ”¯åç§°ï¼Œä¾‹å¦‚ master

# å·¥ä½œæµç¯å¢ƒå˜é‡ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è®¾ç½®
env:
  NODE_VERSION: '20.x' # æŒ‡å®šè¦ä½¿ç”¨çš„ Node.js ç‰ˆæœ¬ (å»ºè®®ä½¿ç”¨æœ€æ–°çš„ LTS ç‰ˆæœ¬ä¹‹ä¸€)

jobs:
  build-and-deploy:
    name: Build and Deploy
    runs-on: ubuntu-latest # æŒ‡å®šè¿è¡Œå™¨ç¯å¢ƒ

    steps:
      - name: Checkout ğŸ›ï¸
        uses: actions/checkout@v4 #æ£€å‡ºæ‚¨çš„ä»“åº“ä»£ç 

      - name: Set up Node.js ${{ env.NODE_VERSION }} âš™ï¸
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'yarn' # ç¼“å­˜ Yarn ä¾èµ–ä»¥åŠ å¿«åç»­æ„å»ºé€Ÿåº¦

      - name: Install dependencies ğŸ“¦
        run: yarn install --frozen-lockfile # ä½¿ç”¨ --frozen-lockfile ç¡®ä¿ä½¿ç”¨é”æ–‡ä»¶çš„ç²¾ç¡®ä¾èµ–ç‰ˆæœ¬

      - name: Build project ğŸ› ï¸
        run: yarn build # è¿è¡Œ package.json ä¸­çš„ build è„šæœ¬
        # å¦‚æœæ‚¨çš„ vue.config.js ä¸­çš„ publicPath éœ€è¦åŠ¨æ€è®¾ç½®ï¼ˆä¾‹å¦‚åŸºäºä»“åº“åç§°ï¼‰
        # æ‚¨å¯èƒ½éœ€è¦åœ¨è¿™é‡Œæˆ–æ„å»ºè„šæœ¬ä¸­å¤„ç†å®ƒã€‚
        # ä¾‹å¦‚ï¼š run: VUE_APP_PUBLIC_PATH=/${{ github.event.repository.name }}/ yarn build
        # ä½†é€šå¸¸åœ¨ vue.config.js ä¸­ä½¿ç”¨ process.env.BASE_URL æˆ–ç±»ä¼¼çš„é€»è¾‘æ›´å¥½

      - name: Deploy to GitHub Pages ğŸš€
        uses: peaceiris/actions-gh-pages@v4 # ä¸€ä¸ªæµè¡Œçš„éƒ¨ç½²åˆ° gh-pages åˆ†æ”¯çš„ Action
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }} # GitHub è‡ªåŠ¨æä¾›çš„ tokenï¼Œç”¨äºè®¤è¯
          publish_dir: ./dist # æŒ‡å®šè¦å‘å¸ƒçš„ç›®å½• (Vue CLI é»˜è®¤æ„å»ºåˆ° dist)
          # publish_branch: gh-pages # é»˜è®¤å°±æ˜¯ gh-pagesï¼Œå¯ä»¥çœç•¥
          # user_name: 'github-actions[bot]' # è‡ªå®šä¹‰æäº¤è€…åç§° (å¯é€‰)
          # user_email: 'github-actions[bot]@users.noreply.github.com' # è‡ªå®šä¹‰æäº¤è€…é‚®ç®± (å¯é€‰)
          # commit_message: ${{ github.event.head_commit.message }} # ä½¿ç”¨æœ€åä¸€æ¬¡æäº¤çš„æ¶ˆæ¯ä½œä¸ºéƒ¨ç½²æäº¤æ¶ˆæ¯ (å¯é€‰)
          # cname: your-custom-domain.com # å¦‚æœæ‚¨ä½¿ç”¨è‡ªå®šä¹‰åŸŸåï¼Œè¯·å–æ¶ˆæ³¨é‡Šå¹¶æ›¿æ¢